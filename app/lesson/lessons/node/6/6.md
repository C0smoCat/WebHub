## Mongoose

Mongoose представляет  специальную ODM-библиотеку (Object Data Modelling) для работы с MongoDB, которая позволяет сопоставлять объекты классов и документы коллекций из базы данных. 
Грубо говоря, Mongoose работает подобно инструментам ORM. Официальный сайт библиотеки, где можно посмотреть всю необходимую документацию: http://mongoosejs.com

Для работы с Mongoose продолжим работу с проектом из прошлых тем и вначале установим саму библиотеку с помощью команды:

```

```

Далее определим следующий код в файле приложения app.js:

```js
const mongoose = require("mongoose");
const Schema = mongoose.Schema;
 
// установка схемы
const userScheme = new Schema({
    name: String,
    age: Number
});
 
// подключение
mongoose.connect("mongodb://localhost:27017/usersdb", { useNewUrlParser: true });
 
const User = mongoose.model("User", userScheme);
const user = new User({
    name: "Bill",
    age: 41
});
 
user.save(function(err){
    mongoose.disconnect();  // отключение от базы данных
     
    if(err) return console.log(err);
    console.log("Сохранен объект", user);
});
```

Здесь прежде всего нам надо подключить mongoose:

```js
const mongoose = require("mongoose");
```

Данные, которые используются в Mongoose, описываются определенной схемой. Например, в прошлых темах мы сохраняли в базу данных объекты с двумя 
свойствами `name` и `age`. Поэтому описываем здесь следующую схему:

```js
const Schema = mongoose.Schema;

// установка схемы
const userScheme = new Schema({
    name: String,
    age: Number
});
```

Схема содержит метаданные объектов. В частности, здесь устанавливаем, какие свойства будет иметь объект и какой у них будет тип данных. То есть это схема, которая 
описывает объект пользователя.

Затем, используя эту схему, создаем модель пользователя:

```js
const User = mongoose.model("User", userScheme);
```

Первый параметр в методе **mongoose.model** указывает на название модели. Mongoose затем будет автоматически искать в 
базе данных коллекцию, название которой соответствует названию модели во множественном числе. 
Например, в данном случае название модели "User". Во множественном числе в соответствии с правилами английского языка это "users". 
Поэтому при работе с данными модели User (добавлении, удалении, редактировании и получении объектов) mongoose будет обращаться к коллекции 
"users". Если такая коллекция есть в бд, то с ней будет идти взаимодействие. Если такой коллекции в базе данных нет, то она будет создана автоматически.

Второй параметр функции `mongoose.model` - собственно схема.

Далее мы можем создавать объекты этой модели:

```js
const user = new User({
    name: "Bill",
    age: 41
});
```

Для подключения к базе данных применяется метод **mongoose.connect()**, в который передается адрес базы данных на сервере mongo:

```js
mongoose.connect("mongodb://localhost:27017/usersdb");
```

И в конце у объекта вызывается метод **save**. Этот метод определен для всех создаваемых моделей, он сохраняет текущий объект в базу данных:

```js
user.save(function(err){
    
    mongoose.disconnect();    // отключение от базы данных
    if(err) return console.log(err);
    
    console.log("Сохранен объект", user);
});
```

С помощью метода **mongoose.disconnect();** происходит отключение от бд.

Так как метод save возвращает promise, то есть и другая форма сохранения объекта:

```js
user.save()
.then(function(doc){
    console.log("Сохранен объект", doc);
    mongoose.disconnect();    // отключение от базы данных
})
.catch(function (err){
    console.log(err);
    mongoose.disconnect();
});
```

С помощью метода **then** мы можем получить данные, которые возвратил нам сервер и выполнить обработку результата.

Запустим приложение и выполним добавление объекта:

![Mongoose в Node.js](https://metanit.com/web/nodejs/pics/7.10.png)

