## NPM. Package.json. Установка модулей. Определение команд

Кроме встроенных и кастомных модулей Node.js существует огромный пласт различных библиотек и фреймворков, разнообразных утилит, которые создаются сторонними производителями и которые также можно использовать в проекте, например, express, grunt, gulp и так далее. И они тоже нам доступны в рамках Node.js. Чтобы удобнее было работать со всеми сторонними решениями, они распространяются в виде пакетов. Пакет по сути представляет набор функциональностей.

Для автоматизации установки и обновления пакетов, как правило, применяются систему управления пакетами или менеджеры. Непосредственно в Node.js для этой цели используется пакетный менеджер [NPM](https://www.npmjs.com) (Node Package Manager). NPM по умолчанию устанавливается вместе с Node.js, поэтому ничего доустанавливать не требуется. Но можно обновить установленную версию до самой последней. Для этого в командной строке/терминале надо запустить следующую команду:

```

```

Чтобы узнать текущую версию npm, в командной строке/терминале надо ввести следующую команду:

```

```

Для нас менеджер npm важен в том плане, что с его помощью легко управлять пакетами. К примеру, создадим на жестком диске новую папку **modulesapp** (В моем случае папка будет находиться по пути **C:\node\modulesapp**).

Если в дальнейшем нам больше не потребуется express, то мы его можем удалить следующей командой:

```

```

### Файл package.json

Для более удобного управления конфигурацией и пакетами приложения в npm применяется файл конфигурации **package.json**. Так, добавим в папку проекта modulesapp новый файл **package.json**:

```json
{
  "name": "modulesapp",
  "version": "1.0.0"
}
```

Здесь определены только две секции: имя проекта - modulesapp и его версия - 1.0.0. Это минимально необходимое определение файла package.json. Данный файл может включать гораздо больше секций. Подробнее можно посмотреть в [документации](https://docs.npmjs.com/getting-started/using-a-package.json).

Далее для примера установим в проект **express**. Express представляет легковесный веб-фреймворк для упрощения работы с Node.js. В данном случае мы не будем пока подробно рассматривать фреймворк Express, так как это отдельная большая тема. А используем его лишь для того, чтобы понять, как устанавливаются сторонние модули в проект.

Для установки функциональности Express в проект вначале перейдем к папке проекта с помощью команды **cd**. Затем введем команду

```

```

![NPM в Node.js](https://metanit.com/web/nodejs/pics/2.4.png)

После установки express в папке проекта modulesapp появится подпапка **node_modules**, в которой будут хранится все установленные внешние модули. В частности, в подкаталоге **node_modules/express** будут располагаться файлы фреймворка Express.

И после выполнения команды, если мы откроем файл **package.json**, то мы увидим информацию о пакете:

```json
{
  "name": "modulesapp",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1"
  }
}
```

Информация обо всех добавляемых пакетах, которые используются при работе приложения, добавляется в секцию **dependencies**.

Используем добавленный пакет express и для этого определим файл простейшего сервера. Для этого в корневую папку проекта modulesapp добавим новый файл **app.js**:

```js
// получаем модуль Express
const express = require("express");
// создаем приложение
const app = express();

// устанавливаем обработчик для маршрута "/"
app.get("/", function(request, response) {
    response.end("Hello from Express!");
});
// начинаем прослушивание подключений на 3000 порту
app.listen(3000);
```

Первая строка получает установленный модуль express, а вторая создает объект приложения.

В Express мы можем связать обработку запросов с определенными маршрутами. Например, "/" - представляет главную страницу или корневой маршрут. Для обработки запроса вызывается функция `app.get()`. Первый параметр функции - маршрут, а второй - функция, которая будет обрабатывать запрос по этому маршруту.

И чтобы сервер начал прослушивать подключения, надо вызвать метод `app.listen()`, в который передается номер порта.

Запустим сервер командой `node app.js`:

![Установка Express в Node.js](https://metanit.com/web/nodejs/pics/2.5.png)

И в адресной строке браузера введем адрес **http://localhost:3000/**:

![Запуск сервера Express на Node.js](https://metanit.com/web/nodejs/pics/2.6.png)

### Добавление множества пакетов

Файл **package.json** играет большую роль и может облегчить работу с пакетами в различных ситуациях. Например, мы планируем использовать множество пакетов. Но вводить для установки каждого пакета в консоли соответствующую команду не очнь удобно. В этом случае мы можем определить все пакеты в файле package.json и потом одной командой их установить.

Например, изменим файл package.json следующим образом:

```json
{
  "name": "modulesapp",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1",
    "react": "^16.9.0",
    "react-dom": "^16.9.0"
  }
}
```

Здесь добавлены определения двух пакетов, которые представляют библиотеку React.

Затем для загрузки всех пакетов выполнить команду

```

```

Эта команда возьмет определение всех пакетов из секций dependencies и загрузит их в проект. Если пакет с нужной версией уже есть проекте, как в данном случае express, то по новой он не загружается.

### devDependencies

Кроме пакетов, которые применяются в приложении, когда оно запущено и находится в рабочем состояни, например, express, то есть в состоянии "production", есть еще пакеты, которые применяются при разработке приложения и его тестировании. Такие пакеты, как правило, добавляются в другую секцию - **devDependencies**.

Например, загрузим  в проект пакет **jasmine-node**, который используется для тестирования приложения:

```

```

Флаг `--save-dev` указывается, что информацию о пакете следует сохранить именно в секции devDependencies файла package.json:

```json
{
  "name": "modulesapp",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1",
    "react": "^16.9.0",
    "react-dom": "^16.9.0"
  },
  "devDependencies": {
    "jasmine-node": "^3.0.0"
  }
}
```

### Удаление пакетов

Для удаления пакетов используется команда `npm uninstall`. Например:

```

```

При этом не важно, где располагается информация о пакете - в секции dependencies или devDependencies, пакет удаляется из любой из этих секций.

Если нам надо удалить не один пакет, а несколько, то мы можем удалить их определение из файла package.json и ввести команду **npm install**, и удаленые из package.js пакеты также будут удалены из папки node_modules.

Например, изменим файл package.json следующим образом:

```json
{
  "name": "modulesapp",
  "version": "1.0.0",
  "dependencies": {
  }
}
```

Здесь больше нет определения никаких пакетов. И введем команду

```

```

Причем мы также можем одновременно некоторые пакеты добавлять в package.json, а некоторые, наоборот, удалять. И при выполнении команды **npm install** пакетный менеджер новые пакеты установит, а удаленные из package.json пакеты удалит.

### Семантическое версионирование

При определении версии пакета применяется семантическое версионирование. Номер версии, как правило, задается в следующем формате "major.minor.patch". Если в приложении или пакете обнаружен какой-то баг и он исправляется, то увеличивается на единицу число "patch". Если в пакет добавляется какая-то новая функциональность, которая совместима с предыдущей версией пакета, то это небольшое изменение, и увеличивается число "minor". Если же в пакет вносятся какие-то большие изменения, которые несовместимы с предыдущей версией, то увеличивается число "major". То есть глядя на разные версии пакетов, мы можем предположить, насколько велики в них различия.

В примере с express версия пакета содержала, кроме того, дополнительный символ карет: "^4.14.0". Этот символ означает, что при установке пакета в проект с помощью команды `npm install` будет устанавливаться последняя доступная версия от 4.14.0. Фактически это будет последняя доступная версия в промежутке от 4.14.0 до 5.0.0 (>=4.14.0 и <5.0.0). Более подробно про сематическое версионирование в npm можно посмотреть [здесь](https://docs.npmjs.com/misc/semver).

### Команды npm

NPM позволяет определять в файле package.json команды, которые выполняют определенные действия. Например, определим следующий файл **app.js**:

```js
let name = process.argv[2];
let age = process.argv[3];

console.log("name: " + name);
console.log("age: " + age);
```

В данном случае мы получаем переданные при запуске приложению параметры.

И определим следующий файл **package.json**:

```json
{
  "name": "modulesapp",
  "version": "1.0.0",
  "scripts" : {
    "start" : "node app.js",
    "dev" : "node app.js Tom 26"
  }
}
```

Здесь добавлена секция **scripts**, которая определяет две команды. Вообще команд может быть много в соответствии с целями и задачами разработчика.

Первая команда называется **start**. Она по сути выполняет команду `node app.js`, которая выполняет код в файле app.js

Вторая команда назвывается **dev**. Она также выполняет тот же файл, но при этом также передает ему два параметра.

Названия команд могут быть произвольными. Но здесь надо учитывать один момент. Есть условно говоря есть зарезервированные названия для команд, например, `start`, `test`, `run` и ряд других. Их не очень много. И как раз первая команда из выше определенного файла package.json называется start. И для выполнения подобных команд в терминале/командной строке надо выполнить команду

```cmd
npm [название_команды]
```

Например, для запуска команды `start`

```cmd
npm start
```

Команды с остальными названия, как например, "dev" в вышеопределенном файле, запускаются так:

```cmd
npm run [название_команды]
```

Например, последовательно выполним обе команды:

![Выполнение скриптов npm](https://metanit.com/web/nodejs/pics/2.24.png)


> Материал взят с сайта metanit.com