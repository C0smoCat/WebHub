## Анонимные методы

С делегатами тесно связаны **анонимные методы**. Анонимные методы используются для создания экземпляров делегатов.

Определение анонимных методов начинается с ключевого слова **delegate**, после которого идет в скобках список параметров и тело метода 
в фигурных скобках:

```cs
delegate(параметры)
{
	// инструкции
}
```

Например:

```cs
class Program
{
	delegate void MessageHandler(string message);
	static void Main(string[] args)
	{
		MessageHandler handler = delegate(string mes)
		{
			Console.WriteLine(mes);
		};
		handler("hello world!");

		Console.Read();
	}
}
```

Анонимный метод не может существовать сам по себе, он используется для инициализации экземпляра делегата, как в данном случае переменная 
handler представляет анонимный метод. И через эту переменную делегата можно вызвать данный анонимный метод.

И важно отметить, что в отличие от блока методов или условных и циклических конструкций, блок анонимных методов должен заканчиваться точкой с 
запятой после закрывающей фигурной скобки.

Другой пример анонимных методов - передача в качестве аргумента для параметра, который представляет делегат:

```cs
class Program
{
	delegate void MessageHandler(string message);
	static void Main(string[] args)
	{
		ShowMessage("hello!", delegate(string mes)
		{
			Console.WriteLine(mes);
		});

		Console.Read();
	}
	static void ShowMessage(string mes, MessageHandler handler)
	{
		handler(mes);
	}
}
```

Если анонимный метод использует параметры, то они должны соответствовать параметрам делегата. 
Если для анонимного метода не требуется параметров, то скобки с параметрами опускаются. При этом даже если делегат принимает несколько параметров, 
то в анонимном методе можно вовсе опустить параметры:

```cs
class Program
{
	delegate void MessageHandler(string message);
	static void Main(string[] args)
	{
		MessageHandler handler = delegate
		{
			Console.WriteLine("анонимный метод");
		};
		handler("hello world!");	// анонимный метод

		Console.Read();
	}
}
```

То есть если анонимный метод содержит параметры, они обязательно должны соответствовать параметрам делегата. Либо анонимный метод вообще может не содержать никаких параметров, тогда он соответствует любому делегату, 
который имеет тот же тип возвращаемого значения.

При этом параметры анонимного метода не могут быть опущены, если один или несколько параметров определены с модификатором **out**.

Также, как и обычные методы, анонимные могут возвращать результат:

```cs
delegate int Operation(int x, int y);
static void Main(string[] args)
{
	Operation operation = delegate (int x, int y)
	{
		return x + y;
	};
	int d = operation(4, 5);
	Console.WriteLine(d);       // 9
	Console.Read();
}
```

При этом анонимный метод имеет доступ ко всем переменным, определенным во внешнем коде:

```cs
delegate int Operation(int x, int y);
static void Main(string[] args)
{
	int z = 8;
	Operation operation = delegate (int x, int y)
	{
		return x + y + z;
	};
	int d = operation(4, 5);
	Console.WriteLine(d);       // 17
	Console.Read();
}
```

В каких ситуациях используются анонимные методы? Когда нам надо определить однократное действие, которое не имеет много инструкций и нигде больше не используется. В частности, их можно использовать для обработки событий, которые будут рассмотрены далее.

